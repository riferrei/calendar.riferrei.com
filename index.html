<link title="timeline-styles" rel="stylesheet" href="css/timeline.css">
<script src="js/content.js"></script>
<script src="js/timeline.js"></script>

<body>
    <div id='timeline' style="width: 100%; height: 600px"></div>
</body>

<script type="text/javascript">

    let buildWelcome = (welcomeDocument) => {

        photoUrl = welcomeDocument._source.photoUrl
        photoComment = welcomeDocument._source.photoComment
        headline = welcomeDocument._source.headline
        headlineComment = welcomeDocument._source.headlineComment

        // Reference for the TimelineJS JSON data format:
        // https://timeline.knightlab.com/docs/json-format.html
        var timelineData = {
            title: {
                media: {
                    url: photoUrl,
                    credit: photoComment
                },
                text: {
                    headline: headline,
                    text: headlineComment
                }
            }
        };

        let buildNextEvent = (nextEventDocument) => {

            // Save the document that represents the
            // the upcoming event for the timeline.
            nextEventDocId = nextEventDocument._id;
            var selectedSlide = 0;

            let buildEvents = (eventsDocuments) => {

                timelineData.events = []

                for (var i = 0; i < eventsDocuments.length; i++) {

                    // Use the iteration opportunity to find which
                    // document should be the first to start with.
                    if (eventsDocuments[i]._id == nextEventDocId) {
                        selectedSlide = i+1;
                    }

                    rawEvent = eventsDocuments[i]._source;
                    timestamp = new Date(rawEvent['@timestamp']);

                    timelineEvent = {
                        group: rawEvent.groupName,
                        start_date: {
                            year: timestamp.getFullYear(),
                            month: timestamp.getMonth()+1,
                            day: timestamp.getDate()
                        },
                        text: {
                            headline: rawEvent.headline,
                            text: rawEvent.text
                        },
                        media: {
                            url: rawEvent.mediaUrl,
                            thumbnail: rawEvent.thumbnail
                        }
                    }
                    timelineData.events.push(timelineEvent);

                }

                var additionalOptions = {
                    marker_padding: 2,
                    timenav_height_percentage: 50,
                    start_at_slide: selectedSlide,
                    zoom_sequence: [0, 0.2, 0.4, 0.6, 0.8, 1, 2, 3, 4, 5],
                    initial_zoom: 3,
                    font: "ubuntu",
                }

                window.timeline = new TL.Timeline(
                    'timeline', timelineData, additionalOptions);

            }
            getEvents(buildEvents);

        }
        getNextEvent(buildNextEvent);

    }
    getWelcome(buildWelcome);

</script>
